name: ğŸ“® Post lint commit message

on:
  workflow_run:
    workflows: ['Lint commit message']
    types: [completed]

jobs:
  result:
    runs-on: ubuntu-latest
    outputs:
      succeeded: ${{ steps.assert.outputs.succeeded }}
    steps:
      - name: Download result
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: ${{ github.event.workflow.id }}
          run_id: ${{ github.event.workflow_run.id }}
          name: commit-lint-result
      - name: Assert result
        id: assert
        run: echo "::set-output name=succeeded::$(<lint-result.txt)"

  on-success:
    runs-on: ubuntu-latest
    needs: result
    if: ${{ needs.result.outputs.succeeded == 'true' }}
    name: Lint successfully
    steps:
      - uses: actions-awesome/pr-helper@1.1.0
        with:
          actions: 'maintain-comment, add-labels, remove-labels'
          token: ${{ github.token }}
          labels-to-add: 'CommitMessage::Qualified'
          labels-to-remove: 'CommitMessage::Unqualified'
          body-filter: '<!-- ELEMENT_PLUS_COMMIT_LINT -->'

  on-failed:
    runs-on: ubuntu-latest
    needs: result
    name: Lint failed
    if: ${{ needs.result.outputs.succeeded != 'true' }}
    steps:
      - uses: dawidd6/action-download-artifact@v2
        with:
          workflow: ${{ github.event.workflow.id }}
          run_id: ${{ github.event.workflow_run.id }}
          name: commit-lint-report

      - name: Read lint result
        id: read
        uses: juliangruber/read-file-action@v1
        with:
          path: ./commit-lint.txt

      - uses: actions-awesome/pr-helper@1.1.0
        with:
          actions: 'remove-labels, add-labels, maintain-comment'
          labels-to-remove: 'CommitMessage::Qualified'
          labels-to-add: 'CommitMessage::Unqualified'
          token: ${{ github.token }}
          comment-body: |
            Hello, @${{ github.event.pull_request.user.login }}, seems like your commit message contains some issues.

            ä½ å¥½ï¼Œ@${{ github.event.pull_request.user.login }}ï¼Œä½ çš„æäº¤æ¶ˆæ¯ä¸ç¬¦åˆ Element Plus çš„æäº¤æ¶ˆæ¯è§„èŒƒã€‚

            ```
            ${{ steps.read.outputs.content }}
            ```

            Please refer to [Commit Example](https://github.com/element-plus/element-plus/blob/dev/commit-example.md) for fixing it.

            è¯·å‚è€ƒ [æäº¤ç¤ºä¾‹](https://github.com/element-plus/element-plus/blob/dev/commit-example.md) æ¥ä¿®æ”¹ä½ çš„æäº¤æ¶ˆæ¯ã€‚

            Note that all your commits will be squashed into one for being linted, so you might need to revision your commits.
            If you do not know how to do so, please refer to [Keeping git commit history clean](https://about.gitlab.com/blog/2018/06/07/keeping-git-commit-history-clean/) to update your commit message.

            ä½ çš„æ‰€æœ‰ commit(s) ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ª commit æ¥è¢«éªŒè¯ï¼Œæ‰€ä»¥ä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä½ ä¹‹å‰çš„ commit(s) æ¶ˆæ¯ã€‚
            å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•æ¥ä¿®æ”¹ä¹‹å‰å·²ç»æäº¤çš„è®°å½•ï¼Œè¯·å‚è€ƒ[è®©ä½ çš„ Git æäº¤å†å²ä¿æŒå¹²å‡€](https://about.gitlab.com/blog/2018/06/07/keeping-git-commit-history-clean/)æ¥ä¿®æ”¹ã€‚

            If you find it hard to do it by yourself, run command below to use an intuitive tool for that.

            å¦‚æœä½ è§‰å¾—è‡ªå·±å†™è¿™ä¸ªæäº¤æ¶ˆæ¯å¾ˆéš¾ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼å·¥å…·æ¥å¸®åŠ©ä½ ç”Ÿæˆæ¶ˆæ¯ã€‚

            ```shell
            pnpm cz
            ```

            Note that if you do not fix the commit message issue, your PR will be automatically closed within **3 days**.

            è¯·æ³¨æ„ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‰ç…§è§„èŒƒä¿®æ”¹ä½ çš„æäº¤æ¶ˆæ¯ï¼Œä½ çš„ PR å°†ä¼šåœ¨**ä¸‰å¤©**å†…è¢«è‡ªåŠ¨å…³é—­ã€‚

            <sub>Generated with :heart: by ElementPlusBot</sub>
            <!-- ELEMENT_PLUS_COMMIT_LINT -->
          body-filter: '<!-- ELEMENT_PLUS_COMMIT_LINT -->'
      - run: exit 1
